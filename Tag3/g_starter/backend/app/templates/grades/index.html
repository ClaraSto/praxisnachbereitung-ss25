<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ title }}</title>
    <script src="https://unpkg.com/htmx.org@1.9.12"></script>
    <style>
      :root { font-family: -apple-system, system-ui, Segoe UI, Roboto, Ubuntu, Cantarell, Helvetica, Arial; }
      body { margin: 0; padding: 2rem; background: #f3f4f6; }
      .card { max-width: 1200px; margin: 2rem auto; padding: 2rem; background: white; border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.05); }
      h1 { margin-top: 0; }
      h2 { margin-top: 2rem; }
      form { margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 1.5rem; align-items: center; }
      label { display:block; font-size: .9rem; margin-bottom: .3rem; }
      input, select { width: 100%; padding: .35rem .55rem; border-radius: 8px; border: 1px solid #d1d5db; }
      button { padding: .45rem .9rem; border-radius: 999px; border: none; background: #2563eb; color: white; cursor: pointer; display: inline-flex; align-items: center; }
      button:hover { background: #1d4ed8; }
      table { border-collapse: collapse; width: 100%; margin-top: 1.5rem; }
      th, td { border: 1px solid #e5e7eb; padding: .5rem .6rem; text-align: left; font-size: .9rem; }
      th { background: #f9fafb; }
      .row { display: grid; grid-template-columns: 1.6fr 1.6fr 1fr; gap: 1.25rem; width: 100%; align-items: end; }
      .full-row { width: 100%; display: flex; justify-content: flex-start; }
      .row > div { min-width: 0; }
      .stack { display: flex; flex-direction: column; gap: 1.75rem; margin-top: 1.5rem; }
      .section { border: 1px solid #e5e7eb; border-radius: 12px; padding: 1.25rem; background: #f9fafb; }
      .section h3 { margin-top: 1rem; }
      .section form { margin-top: .75rem; }
      .box-title { font-weight: 600; margin-bottom: .25rem; }
      .muted { color: #6b7280; font-size: .9rem; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>ðŸŽ“ NotenÃ¼bersicht</h1>
      <p>Mini-App fÃ¼r <strong>Studierende / Module / Grade</strong>. Es kÃ¶nnen neue Studierende, Module und Noten anlegt werden.</p>

      <div class="stack">
        <div class="section">
          <div class="box-title">Stammdaten</div>
          <p class="muted">Hier kÃ¶nnen weitere Studierende und Module anlegt werden.</p>

          <h3>Studierende anlegen</h3>
          <form method="post" action="/students">
            <label>
              Matrikel
              <input type="text" name="matrikel" required />
            </label>
            <label>
              Vorname
              <input type="text" name="vorname" required />
            </label>
            <label>
              Nachname
              <input type="text" name="nachname" required />
            </label>
            <label>
              Studiengang
              <input type="text" name="programme" required />
            </label>
            <label>
              Semester
              <input type="number" name="semester" min="1" max="12" required />
            </label>
            <div class="full-row">
              <button type="submit">Studierende speichern</button>
            </div>
          </form>

          <h3 style="margin-top:1.5rem;">Neues Modul</h3>
          <form method="post" action="/modules">
            <label>
              Modulname
              <input type="text" name="name" required />
            </label>
            <div class="full-row">
              <button type="submit">Modul speichern</button>
            </div>
          </form>

          <p class="muted" style="margin-top:1rem;">
            Hinweis: Doppelte Matrikelnummern bzw. Modulnamen werden ignoriert (DB-Schutz).
          </p>
        </div>

        <div class="section">
          <div class="box-title">Neue Note erfassen</div>
          {% if not students or not modules %}
            <p class="muted">
              FÃ¼r Noten braucht es mindestens einen Studierenden und ein Modul.
            </p>
          {% else %}
            <form
              hx-post="/grades/htmx"
              hx-target="#grade-list"
              hx-swap="innerHTML"
            >
              <div class="row">
                <div>
                  <label>
                    Studierende
                    <select
                      name="student_id"
                      hx-get="/grades/htmx"
                      hx-target="#grade-list"
                      hx-trigger="change"
                    >
                      {% for s in students %}
                        <option value="{{ s.student_id }}" {% if s.student_id == current_student_id %}selected{% endif %}>
                          {{ s.matrikel }} â€“ {{ s.vorname }} {{ s.nachname }}
                        </option>
                      {% endfor %}
                    </select>
                  </label>
                </div>

                <div>
                  <label>
                    Modul
                    <select name="module_id">
                      {% for m in modules %}
                        <option value="{{ m.module_id }}">{{ m.name }}</option>
                      {% endfor %}
                    </select>
                  </label>
                </div>

                <div>
                  <label>
                    Note
                    <input type="text" name="grade_value" required placeholder="z. B. 1,7 oder passed" />
                  </label>
                </div>
              </div>

              <div class="full-row">
                <button type="submit">Note speichern</button>
              </div>
            </form>
          {% endif %}

          <div id="grade-list">
            {% include "grades/_list.html" %}
          </div>
        </div>
      </div>

    </div>
  </body>
</html>
